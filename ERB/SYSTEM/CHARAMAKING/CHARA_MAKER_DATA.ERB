;-----------------------------------------
;캐릭터 메이크 데이터의세이브&로드화면
;ARG가 진정한 때세이브화면
;-----------------------------------------
@CHARAMAKE_DATA_MENU, ARG
#LOCALSIZE 2
#LOCALSSIZE 1
#DIMS LOCALS_A, 7
#DIMS LOCALS_B, 100
#DIM LINE
#DIM SAVE
#DIM CHARA
#DIM PAGE
LOADGLOBAL
PAGE = 0
LINE = LINECOUNT
$START
CLEARLINE LINECOUNT - LINE
FOR LOCAL, 0, 5
	RESETCOLOR
	;데이터가 존재하지 않는 것
	IF GLOBALS:LOCAL == ""
		LOCALS = [{LOCAL}] ＥＭＰＴＹ
;OriginalString : ┌%LOCALS + (84 - STRLENS(LOCALS)) / 2 * "─"%┐
		PRINTFORML ┌%LOCALS + (84 - STRLENS(LOCALS)) / 2 * "─"%┐
;OriginalString : │%84 * " "%│
		PRINTFORML │%84 * " "%│
		LOCALS = 
	ELSE
		SPLIT GLOBALS:LOCAL, "_", LOCALS_A
		SPLIT LOCALS_A:1, "/", LOCALS_B
		LOCALS = [{LOCAL}] %LOCALS_B:1%
		;메모 기능봉인
		; 메모:%LOCALS_A%
		SIF STRLENS(LOCALS) % 2
			LOCALS += " "
;OriginalString : ┌
		PRINTFORM ┌
;OriginalString : LOCALS, LOCAL
		PRINTBUTTON LOCALS, LOCAL
;OriginalString : %(84 - STRLENS(LOCALS)) / 2 * "─"%┐
		PRINTFORML %(84 - STRLENS(LOCALS)) / 2 * "─"%┐
		LOCALS = 
		FOR LOCAL:1, 0, VARSIZE("TALENT")
			SIF TALENTNAME:(LOCAL:1) == ""
				CONTINUE
			SIF STRFIND(LOCALS_A:6, TALENTNAME:(LOCAL:1)) == -1
				CONTINUE
			IF STRLENS(LOCALS) + STRLENS(TALENTNAME:(LOCAL:1)) + 2 + 4 > 84
;OriginalString : │%LOCALS,84,LEFT%│
				PRINTFORML │%LOCALS,84,LEFT%│
				LOCALS = 
			ENDIF
		 	LOCALS += "["+TALENTNAME:(LOCAL:1)+"]" 
		NEXT
	ENDIF
 	IF LOCALS != ""
;OriginalString : │%LOCALS,84,LEFT%│
 		PRINTFORML │%LOCALS,84,LEFT%│
 		LOCALS = ""
 	ENDIF
;OriginalString : └%42 * "─"%┘
	PRINTFORML └%42 * "─"%┘
NEXT
;OriginalString : [99] 돌아가기
PRINTFORML [99] 돌아온다
INPUT
SIF RESULT == 99
	RETURN 0
IF RANGE(RESULT, 0, 4)
	SAVE = RESULT
	;데이터가 있는 경우 캐릭터 표시는 확실히 실시한다
	IF GLOBALS:SAVE != ""
		CALL CHARAMAKE_LOAD, RESULT
		CHARA = RESULT
		CALL PRINTSTATE_CHARAMAKE(CHARA)
	ENDIF
	;로드
	IF !ARG
		IF GLOBALS:SAVE != ""
			CALL PRINT_DIALOG("이 캐릭터를 로드하겠습니까?", 1, 1, 1)
;OriginalString : [0] はい
			PRINTL [0] 네
;OriginalString : [1] いいえ
			PRINTL [1] 아니오
			CALL INPUTINT(0, 1)
			IF RESULT
				DELCHARA CHARA
				GOTO START
			ELSE
				;주인을 사크
				DELCHARA 0
				;유카리와 주인공을 바꿔 넣어 둔다
				SWAPCHARA 0, 1
				RETURN 1
			ENDIF
		ENDIF
	ELSE
		IF GLOBALS:SAVE != ""
			;어느 쪽으로 하든. 지운다
			DELCHARA CHARA
			CALL PRINT_DIALOG("데이터를 덧쓰기해도하시겠습니까?", 1, 1, 1)
;OriginalString : [0] はい
			PRINTL [0] 네
;OriginalString : [1] いいえ
			PRINTL [1] 아니오
			CALL INPUTINT(0, 1)
			SIF RESULT
				GOTO START
		ENDIF
		;캐릭터 보존
		CALL CHARAMAKE_SAVE, SAVE, MASTER
		CALL PRINT_DIALOG("캐릭터를 보존 섬했다", 2, 2, 2)
	ENDIF
ENDIF
GOTO START

;=========================================================================
;@CHARA_MAKER_SAVE
;캐릭터 메이커로 작성했다데이터를 GLOBALS에 보존을 하는 함수
;ARG   GLOBALS:ARG에 데이터를 보존한다
;ARG:1 ARG:1의 캐릭터등록번호의 소질을세이브 한다. 생략했다경우는 0번의 캐릭터
;		0    1    2   3     4   5       6
;보존은 메모_이름 _ABL_CFLAG_EXP_MAXBASE_TALENT
;==========================================================================
@CHARAMAKE_SAVE, ARG, ARG:1 = -1
#DIM CHARA, 1
CHARA = ARG:1 == -1 ? 0 # ARG:1
;초기화
GLOBALS:ARG = 
;우선 메모 기능 필요없을까?
;PRINTFORML 이세이브데이터의 내용을 나타내는 메모를 입력해 주세요
;$INPUT_LOOP
;INPUTS
;PRINTFORML 「%RESULTS%」로하시겠습니까?
;PRINTL [0] 네
;PRINTL [1] 아니오
;LOCALS = %RESULTS%
;CALL INPUTINT(0, 1)
;IF RESULT
;	PRINTL 에서는, 다시 입력해 주세요
;	GOTO INPUT_LOOP
;ENDIF
GLOBALS:ARG += LOCALS + "_"
;이름 관계
GLOBALS:ARG += NAME:(ARG:1) + "/" + CALLNAME:(ARG:1) + "_"
;ABL
LOCAL:1 = 0
FOR LOCAL, 0, VARSIZE("ABL")
	SIF ABLNAME:LOCAL == ""
		CONTINUE
	IF ABL:CHARA:LOCAL
		SIF LOCAL:1++ != 0
			GLOBALS:ARG += "/"
		GLOBALS:ARG += @"%ABLNAME:LOCAL%,{ABL:CHARA:LOCAL}"
	ENDIF
NEXT
GLOBALS:ARG += "_"
;CFLAG
LOCAL:1 = 0
FOR LOCAL, 0, VARSIZE("BASE")
	SIF CFLAGNAME:LOCAL == ""
		CONTINUE
	IF CFLAG:CHARA:LOCAL
		SIF LOCAL:1++ != 0
			GLOBALS:ARG += "/"
		GLOBALS:ARG += @"%CFLAGNAME:LOCAL%,{CFLAG:CHARA:LOCAL}"
	ENDIF
NEXT
GLOBALS:ARG += "_"
;EXP
LOCAL:1 = 0
FOR LOCAL, 0, VARSIZE("EXP")
	SIF EXPNAME:LOCAL == ""
		CONTINUE
	IF EXP:CHARA:LOCAL
		SIF LOCAL:1++ != 0
			GLOBALS:ARG += "/"
		GLOBALS:ARG += @"%EXPNAME:LOCAL%,{EXP:CHARA:LOCAL}"
	ENDIF
NEXT
GLOBALS:ARG += "_"
;MAXBASE
LOCAL:1 = 0
FOR LOCAL, 0, VARSIZE("MAXBASE")
	SIF BASENAME:LOCAL == ""
		CONTINUE
	IF MAXBASE:CHARA:LOCAL
		SIF LOCAL:1++ != 0
			GLOBALS:ARG += "/"
		GLOBALS:ARG += @"%BASENAME:LOCAL%,{MAXBASE:CHARA:LOCAL}"
	ENDIF
NEXT
GLOBALS:ARG += "_"
;TALENT
LOCAL:1 = 0
FOR LOCAL, 0, VARSIZE("TALENT")
	SIF TALENTNAME:LOCAL == ""
		CONTINUE
	IF TALENT:CHARA:LOCAL
		SIF LOCAL:1++ != 0
			GLOBALS:ARG += "/"
		GLOBALS:ARG += @"%TALENTNAME:LOCAL%,{TALENT:CHARA:LOCAL}"
	ENDIF
NEXT
SAVEGLOBAL

;=========================================================================
;@CHARA_MAKER_LOAD
;캐릭터 메이커로 작성했다데이터를 GLOBALS에 보존을 하는 함수
;ARG   GLOBALS:ARG의 데이터를 읽어들인다
;		0    1    2   3     4   5       6
;보존은 메모_이름 _ABL_CFLAG_EXP_MAXBASE_TALENT
;==========================================================================
@CHARAMAKE_LOAD, ARG
#DIMS RESULTS_A, 7
#DIMS RESULTS_B, 100
#DIMS RESULTS_C, 2
#DIM CHARA
ADDVOIDCHARA
CHARA = CHARANUM -1
SPLIT GLOBALS:ARG, "_", RESULTS_A
SPLIT RESULTS_A:1, "/", RESULTS_B
;이름
NAME:CHARA = %RESULTS_B%
CALLNAME:CHARA = %RESULTS_B:1%


SPLIT RESULTS_A:2, "/", RESULTS_B
;ABL
FOR LOCAL, 0, RESULT
	SIF RESULTS_B == ""
		CONTINUE
	SPLIT RESULTS_B:LOCAL, ",", RESULTS_C
	ABL:CHARA:RESULTS_C = TOINT(RESULTS_C:1)
NEXT

SPLIT RESULTS_A:3, "/", RESULTS_B
;CFLAG
FOR LOCAL, 0, RESULT
	SIF RESULTS_B == ""
		CONTINUE
	SPLIT RESULTS_B:LOCAL, ",", RESULTS_C
	CFLAG:CHARA:RESULTS_C = TOINT(RESULTS_C:1)
NEXT

SPLIT RESULTS_A:4, "/", RESULTS_B
;EXP
FOR LOCAL, 0, RESULT
	SIF RESULTS_B == ""
		CONTINUE
	SPLIT RESULTS_B:LOCAL, ",", RESULTS_C
	EXP:CHARA:RESULTS_C = TOINT(RESULTS_C:1)
NEXT

SPLIT RESULTS_A:5, "/", RESULTS_B
;MAXBASE
FOR LOCAL, 0, RESULT
	SIF RESULTS_B == ""
		CONTINUE
	SPLIT RESULTS_B:LOCAL, ",", RESULTS_C
	MAXBASE:CHARA:RESULTS_C = TOINT(RESULTS_C:1)
	BASE:CHARA:RESULTS_C = TOINT(RESULTS_C:1)
NEXT

SPLIT RESULTS_A:6, "/", RESULTS_B
;TALENT
FOR LOCAL, 0, RESULT
	SIF RESULTS_B == ""
		CONTINUE
	SPLIT RESULTS_B:LOCAL, ",", RESULTS_C
	TALENT:CHARA:RESULTS_C = TOINT(RESULTS_C:1)
NEXT
RETURN CHARA

;캐릭터 데이터 표시 함수
@PRINTSTATE_CHARAMAKE(ARG)
DRAWLINE
;OriginalString : ■ %CALLNAME:ARG% ■
PRINTFORM ■ %CALLNAME:ARG% ■
;OriginalString : 
PRINTL 
;OriginalString : [LV {CFLAG:ARG:0,2}  EXP {CFLAG:ARG:1,6}/{CFLAG:ARG:4,6}  NEXT {CFLAG:ARG:필요경험치 - CFLAG:ARG:1,6}]
PRINTFORML [LV {CFLAG:ARG:0,2}  EXP {CFLAG:ARG:1,6}/{CFLAG:ARG:4,6}  NEXT {CFLAG:ARG:필요경험치 - CFLAG:ARG:1,6}]
CALL PRINT_BASEL("체력", ARG, 0, 32, 1)
CALL PRINT_BASEL("기력", ARG, 1, 32, 1)
SIF MAXBASE:ARG:이성
	CALL PRINT_BASEL("이성", ARG, 5, 32, 1)
SIF MAXBASE:ARG:사정
	CALL PRINT_BASEL("정력", ARG, 2, 32, 1)
CALL NEW_PRINT_TALENT(ARG)
CALL NEW_PRINT_EXP(ARG)
CALL NEW_PRINT_ABL(ARG)

